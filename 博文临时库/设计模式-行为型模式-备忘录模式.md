# 备忘录模式

亦称： 快照、 Snapshot、 Memento

在不暴露对象实现细节的情况下保存和恢复对象之前的状态





要点：

- 确定原发器和备忘录角色的类
- 备忘录类设为不可变。 备忘录只能通过构造函数一次性接收数据。 该类中不能包含设置器。
- 原发器中添加一个创建备忘录的方法，添加一个用于恢复自身状态的方法
- 负责人必须要知道何时向原发器请求新的备忘录、 如何存储备忘录以及何时使用特定备忘录来对原发器进行恢复。
- 

（备忘录模式有多种实现，下面这种是在支持内部类/嵌套类的编程语言中的做法）

![](E:\_data\博文临时库\博文中的图片\备忘录模式-嵌套类实现.png)



- 需要创建对象状态快照来恢复其之前的状态时

  允许你复制对象中的全部状态 （包括私有成员变量）

- 当直接访问对象的成员变量、 获取器或设置器将导致封装被突破时

例子：

- 

备忘录的基本原则可通过序列化来实现， 这在 Java 语言中很常见。 尽管备忘录不是生成对象状态快照的唯一或最有效方法， 但它能在保护原始对象的结构不暴露给其他对象的情况下保存对象状态的备份。

下面是核心 Java 程序库中该模式的一些示例：

- 所有 [`java.io.Serializable`](https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html) 的实现都可以模拟备忘录。
- 所有 [`javax.faces.component.StateHolder`](https://docs.oracle.com/javaee/7/api/javax/faces/component/StateHolder.html) 的实现



- 如果客户端过于频繁地创建备忘录， 程序将消耗大量内存
- 负责人必须完整跟踪原发器的生命周期， 这样才能销毁弃用的备忘录
- 绝大部分动态编程语言 （例如 PHP、 Python 和 JavaScript） 不能确保备忘录中的状态不被修改