- DNS、域名
  - DNS 解析域名
- FTP、HTTP
- DHCP
- TELNET
- SMTP和POP3
- MQTT：工作在TCP上
- SSH：一般采用TCP，当然也可以采用其他传输协议

---

**DNS、域名：**

DNS 是一个分布式数据库，提供了主机名和 IP 地址之间相互转换的服务。这里的分布式数据库是指，每个站点只保留它自己的那部分数据。

域名具有层次结构，从上到下依次为：根域名、顶级域名、二级域名

- 根域名
- 顶级域名：edu、com、net
- 二级域名：google、scu

DNS运行在UDP上，使用53号端口。可以有DNS缓存进而加快查询速度。DNS是一个分布式数据库，没有一台DNS用友因特网上全部主机的映射。

- 为什么DNS使用UDP协议？

  - DNS 查询的数据包较小、机制简单，为了这么简短的请求建立tcp觉得太浪费了。
  - DNS 需要高速度。而UDP 协议的额外开销小、有着更好的性能表现

- DNS 不仅使用了 UDP 协议，也使用了 TCP 协议

  - DNS 区域传输：

    DNS包含一种AXFR 类型的特殊查询。这种特殊查询主要用于 DNS 区域传输，它的作用就是在多个命名服务器之间快速迁移记录，由于查询返回的响应比较大，所以会使用 TCP 协议来传输数据包。

  - DNS 解析器或者服务器在发送非区域传输查询时，必须先发送一个 UDP 查询，如果该查询的响应被截断，它应该尝试使用 TCP 协议重新请求；

  - DNS 查询由于 DNSSEC 和 IPv6 的引入迅速膨胀，导致 DNS 响应经常超过 MTU 造成数据的分片和丢失，我们需要依靠更加可靠的 TCP 协议完成数据的传输；

大概有四种DNS服务器：

- 根DNS服务器（A-M）
- 顶级域DNS服务器（com、edu、org、net）
- 权威DNS服务器（每个机构）
- 本地DNS服务器（本地ISP厂商）

递归DNS查询和迭代DNS查询。多数采用迭代查询。

- 递归查询：

  计算机==>本地DNS服务器==>根DNS服务器==>顶级域DNS服务器==>权威DNS服务器，然后

  权威DNS服务器==>顶级域DNS服务器==>根DNS服务器==>本地DNS服务器==>计算机

- 迭代查询

  计算机==>本地DNS服务器

  本地DNS服务器==>根DNS服务器==>本地DNS服务器

  本地DNS服务器==>顶级域DNS服务器==>本地DNS服务器

  本地DNS服务器==>权威DNS服务器==>本地DNS服务器

  本地DNS服务器==>计算机

DNS服务器通过手动设置、DHCP查询等可以获知。

- DNS服务器的IP地址，有可能是动态的，每次上网时由网关分配，这叫做DHCP机制
- 也有可能是事先指定的固定地址。Linux系统里面，DNS服务器的IP地址保存在`/etc/resolv.conf`文件

https://www.ruanyifeng.com/blog/2016/06/dns.html

---

**FTP：**

FTP 使用 TCP 进行连接，需要两个连接来传送一个文件：

- 控制连接：服务器打开端口号 21 等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答。
- 数据连接：用来传送一个文件数据。

根据数据连接是否是服务器端主动建立，FTP 有主动和被动两种模式：

主动模式要求客户端开放端口号给服务器端，需要去配置客户端的防火墙。被动模式只需要服务器端开放端口号即可，无需客户端配置防火墙。但是被动模式会导致服务器端的安全性减弱，因为开放了过多的端口号。

---

**DHCP：**

DHCP (Dynamic Host Configuration Protocol) 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址等信息。

DHCP 配置的内容不仅是 IP 地址，还包括子网掩码、网关 IP 地址。

DHCP 工作过程如下：

1. 客户端发送 Discover 报文，该报文的目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68，被放入 UDP 中，该报文被广播到同一个子网的所有主机上。如果客户端和 DHCP 服务器不在同一个子网，就需要使用中继代理。
2. DHCP 服务器收到 Discover 报文之后，发送 Offer 报文给客户端，该报文包含了客户端所需要的信息。因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择。
3. 如果客户端选择了某个 DHCP 服务器提供的信息，那么就发送 Request 报文给该 DHCP 服务器。
4. DHCP 服务器发送 Ack 报文，表示客户端此时可以使用提供给它的信息。

---

**电子邮件协议SMTP和POP3：**

一个电子邮件系统由三部分组成：用户代理、邮件服务器以及邮件协议。

邮件协议包含发送协议和读取协议，发送协议常用 SMTP，读取协议常用 POP3 和 IMAP。



# 参考

> 1. https://draveness.me/whys-the-design-dns-udp-tcp/