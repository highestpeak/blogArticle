1. 线段树

树是一种数据结构，而不是一种算法。

但是有与树有关的各种算法，要总结树的结构的变体，然后总结各种算法，



数据结构：

1. 二叉树、镜像二叉树
   - ❌用语言描述一颗二叉树
   - ❌二叉树遍历
2. B+树和B树
   - 区别
3. 红黑树
   - 红黑树是什么？怎么实现？时间复杂度 

平衡树：B树家族：2-3树、B树，AVL树，红黑树



 树存在的原因是什么？

一些特殊的问题本身就是特殊的结构，本身就是树状的结构。

树是一种从线性空间到非线性空间的自然过渡。

树更是一些算法的结构体现，例如递归算法，分治算法等。

树很多情况下也被用于索引技术，这被数据库应用广泛使用。



树本身其实可以说支持"二分检索"。这就提高了检索性能。



索引技术

这里只讨论树状索引本身，而不阐述为什么要采用他，这部分请查看数据库的文章论述-索引系列文章。

要了解树状索引，就得了解一下线性索引。

线性索引不能很好的完成插入、删除操作。线性索引能够提供对记录高效的检索和随机访问，这是因为它支持**二分检索**。但是二分检索可能会需要多次磁盘访问，这样做代价很高，所以就出现了二级线性索引等。使用线性索引读取记录就会设计“两次”磁盘读取：一次读索引文件，一次读数据库文件。

线性索引的更新代价很高，因为数组的全部内容都要移动一个位置。另一个问题是可能有大量的重复关键码，这样就很浪费空间。

然而这还不是我们要用树的原因，因为我们还可以改进：例如采用二维数组。二维线性索引：每一列列出与某个辅码值相关的主码。但是这样就要固定数组长度，一种更好的方法是有一个辅码值的一维数组，每个辅码值与一个链表关联。如果索引存储在主存中，这样做能工作得很好，但是当索引存储在磁盘就不一样了：关键码的链表可能分散在多个磁盘块中。<u>*todo：此外还有一种倒排文件、倒排表*</u>。

如果能把线性索引分成多个快，每次更新之影响其中一部分索引，那么线性索引作为主码索引还是很好的，这种思想就汇集到了今天最广泛使用的索引方法——B+树中。（每次只影响一部分这个想法也贯穿了CS学科本身）

ISAM索引是一个IBM曾经广泛使用的索引，它是一种线性索引的改进形式。



当数据库极少或者没有记录插入和删除时，线性索引是很有效率的。ISAM对于有限次更新也足够了，但不适用于频繁修改。

但是一般的数据库具有的特征不适用于上面的假设，对于这样的数据库就需要更好的数据组织方式。

一般数据库的特征：

- 需要频繁更新
- 检索时可能根据多个关键码组合进行检索
- 也可能适用范围查询检索。



然后我们想到了二叉检索树BST，它可以存储重复的值并且插入删除检索都很有效率，可以完成有效率的范围查询。但是BST会变得不平衡，叶节点的深度容易成倍的变化。

如果树结构存储在主存中，这可能不是一个重要问题，然而，如果树结构在磁盘中，叶节点的深度可能导致访问每一个节点都会从磁盘读取。

如果一个节点与其父节点在同一个磁盘块中，那么一旦父节点在主存中他也就进入了主存。但是一个节点与他的父节点并不总是在同一个磁盘块中。BST访问节点很可能就会读取另一个磁盘块。



使用基于磁盘的BST就需要注意两个重要的问题：

- 如何保持树结构的平衡。
- 如何在磁盘块中安排节点。即按块存储，并使得磁盘I/O最少

如果采用一种规则，例如规定BST是完全二叉树，这会引起树结构中大量数据的重组，这样行不通。

这个时候就需要引入另一种树，在更新后仍能自动保持平衡，并且适合按块存储。这就将引入2-3树，然后自然引出B树。



（<u>*todo：2-3树详细内容暂时不赘述*</u>）

- 一个节点包含一个或两个关键码
- 每个内部节点有两个子节点或者三个子节点
- 所有叶节点在同一层，因此平衡

2-3树的分裂操作：取中向上传递，然后分裂成两个节点



B树：

- 根要么是一个叶节点，要么有两个子节点
- 每个内部节点有[m/2]到m个子节点
- 所有子节点在同一层
- 保证至少一定比例的节点半满
- 一个B树节点通常大小就相当于一个磁盘块的大小

B树解决的问题：

- B树把相关记录放到同一个磁盘块中，利用了访问局部性来减少磁盘I/O，更新和检索只影响一些磁盘块。
- 保证至少一定比例的节点半满，改进空间利用率，减少磁盘操作数

B树的检索：当检索到一个节点时，在那个节点采用二分检索。然后沿着正确的分支重复这个过程。

B树的插入保证所有节点至少半满。



B+树本质上是一种管理基于数组的有序线性表的数据组织方法，其中线性表被分成许多块

B+树与BST和B树的最显著区别：B+树只在叶节点存储记录，内部节点存储关键码值。

在B+树纯粹作为索引的情况下，叶节点则存储关键码和指向实际记录的指针，实际记录存储在单独的磁盘文件中。

- B+树的检索必须一直到达相应的叶节点，而B树则可能没有到达叶节点就找到了记录

B+树的叶节点存储的记录数目不定，m阶B+树可能存储多于或少于m条记录，m阶只是说一个内部节点最多m个子树。B+树简单的要求叶节点达到至少半满。

- 半满的要求使得B+树的存储利用率达到了至少50%

B+树的叶节点一般链接起来成为一个双向链表。这样给范围查找等带来了便利。

B+树的删除：

- 直接插入

- 从兄弟节点转移足够的记录，使得两个节点有同样多的记录

  这样做是为了尽可能延迟由于删除引起的节点的再一次下溢

- 如果没有兄弟节点可以借来记录，那么就必须把记录让给兄弟节点，并删除本届点

一个100阶的四层B+树最少有250000条记录，最多有1亿条记录，这样大的数据库不是那么容易遇到，所以B+树能满足绝大部分的需求。